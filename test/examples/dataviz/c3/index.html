<!DOCTYPE html>
<html>
<head>
  <title>Keen IO Comprehensive Test</title>
  <link rel='stylesheet' href='../keen-bootstrap.min.css'>
  <link rel='stylesheet' href='../keen-dashboards.css'>


  <link href='c3.css' rel='stylesheet'>
  <script src='d3.js'></script>
  <script src='c3.js'></script>
</head>
<body>
  <div class='container'>

    <div class='page-header'>
      <h1>C3.js Visual Tests</h1>
    </div>

    <div class='row'>
      <div class='col-sm-4'>
        <h2>Gauge</h2>
        <div id='c3-gauge'></div>
      </div>
      <div class='col-sm-4'>
        <h2>Donut</h2>
        <div id='c3-donut'></div>
      </div>
      <div class='col-sm-4'>
        <h2>Pie</h2>
        <div id='c3-pie'></div>
      </div>
    </div>

    <hr>

    <h2>Area</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-area'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-area-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Line</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-line'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-line-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Bar</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-bar'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-bar-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Area-Spline</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-area-spline'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-area-spline-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Spline</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-spline'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-spline-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Area-Step</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-area-step'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-area-step-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Step</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='c3-step'></div>
      </div>
      <div class='col-sm-6'>
        <div id='c3-step-multi'></div>
      </div>
    </div>
    <hr>

    <h2>Funnel</h2>
    <div class='row'>
      <div class='col-sm-12'>
        <div id='c3-funnel'></div>
      </div>
    </div>
    <hr>

    <h2>Saved Queries (auto-viz)</h2>
    <div class='row'>
      <div class='col-sm-6'>
        <div id='sq-metric'></div>
      </div>
      <div class='col-sm-6'>
        <div id='sq-grouped-metric'></div>
      </div>
    </div>

    <br/>
    <br/>

    <div class='row'>
      <div class='col-sm-6'>
        <div id='sq-interval'></div>
      </div>
      <div class='col-sm-6'>
        <div id='sq-grouped-interval'></div>
      </div>
    </div>

    <br/>
    <br/>

    <div class='row'>
      <div class='col-sm-6'>
        <div id='sq-double-grouped-metric'></div>
      </div>
      <div class='col-sm-6'>
        <div id='sq-double-grouped-interval'></div>
      </div>
    </div>

    <br/>
    <br/>

    <div class='row'>
      <div class='col-sm-6'>
        <div id='sq-extraction'></div>
      </div>
      <div class='col-sm-6'>
        <div id='sq-list'></div>
      </div>
    </div>

    <br/>
    <br/>

  </div>

  <script src='../../../dist/keen.js'></script>
  <script>
  var client = new Keen({
    projectId: '52f2ae5905cd661a7800000a',
    readKey: '4e4d72e5bf8b69686ed87a5a9671bba7ad829fbd10a1c281ee51b6e9c1ce9548e941e1f336f9de9281a5acc66ca8fdabc9b3c806e390eca01665f6a308a9b03d8b332b3fbd9f3cdfc3b3e16b0da6d84851e53fe20fbbce300801b8a401a6395b9f4ab9c89bff566e9678a74ca6624f9b'
  });

  var count = new Keen.Query('count', {
    eventCollection: 'pageviews',
    timeframe: 'this_12_months',
    groupBy: 'user.device_info.browser.family'
  })

  var interval = new Keen.Query('count', {
    eventCollection: 'pageviews',
    timeframe: 'this_12_months',
    interval: 'monthly'
  });

  var multiline = new Keen.Query('count', {
    event_collection: 'pageviews',
    group_by: 'user.device_info.browser.family',
    timeframe: 'this_12_months',
    interval: 'monthly'
  });

  var labelMap = {
    'Firefox': 'FF',
    'Mobile Safari': 'iPhone'
  };

  var reqInterval = client.run(interval);
  var reqMultiline = client.run(multiline);

  // Not required w/ synchronous loading
  // Keen.ready(function(){});

  // Set as default library
  Keen.Dataviz.dataTypeMap['singular'] = { library: 'c3', chartType: 'gauge' };
  Keen.Dataviz.dataTypeMap['categorical'] = { library: 'c3', chartType: 'donut' };
  Keen.Dataviz.dataTypeMap['chronological'] = { library: 'c3', chartType: 'area' };
  Keen.Dataviz.dataTypeMap['cat-chronological'] = { library: 'c3', chartType: 'line' };

  // Better ?
  // Keen.Dataviz.setLibrary('c3'); // use all
  // Keen.Dataviz.setLibrary('c3', ['gauge', 'donut']); // use these

  var c3gauge = new Keen.Dataviz()
    //.library('c3')
    //.chartType('gauge')
    .el(document.getElementById('c3-gauge'))
    .parseRawData({ result: 79.1 })
    .title('Percentage of awesome')
    .chartOptions({
      // gauge: {
      //   label: {
      //     format: function (value, ratio) {
      //       console.log(value, ratio);
      //       return value + ' units';
      //     }
      //   },
      //   units: 'Sits below the label'
      // }
    })
    .render();

  // var c3donut = new Keen.Dataviz()
  //   //.library('c3')
  //   //.chartType('donut')
  //   .el(document.getElementById('c3-donut'))
  //   .parseRawData({ result: [
  //       { label: 'A', result: 9 },
  //       { label: 'B', result: 7 },
  //       { label: 'C', result: 4 }
  //     ]
  //   })
  //   //.title('Best Donut!')
  //   .render();

  client.draw(count, document.getElementById('c3-donut'), {
    library: 'c3',
    chartType: 'donut',
    chartOptions: {

    }
  });

  var c3pie = new Keen.Dataviz()
    .library('c3')
    .chartType('pie')
    .el(document.getElementById('c3-pie'))
    .parseRawData({ result: [
        { label: 'A', result: 9 },
        { label: 'B', result: 7 },
        { label: 'C', result: 4 }
      ]
    })
    .render();

  // Single Interval

  var c3area = new Keen.Dataviz()
    // .library('c3')
    .chartType('area')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-area'))
    .prepare();

  var c3line = new Keen.Dataviz()
    // .library('c3')
    .chartType('line')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-line'))
    .prepare();

  var c3bar = new Keen.Dataviz()
    // .library('c3')
    .chartType('bar')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-bar'))
    .prepare();

  var c3areaspline = new Keen.Dataviz()
    // .library('c3')
    .chartType('area-spline')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-area-spline'))
    .prepare();

  var c3spline = new Keen.Dataviz()
    // .library('c3')
    .chartType('spline')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-spline'))
    .prepare();

  var c3areastep = new Keen.Dataviz()
    // .library('c3')
    .chartType('area-spline')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-area-step'))
    .prepare();

  var c3step = new Keen.Dataviz()
    // .library('c3')
    .chartType('step')
    .height(300)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-step'))
    .prepare();

  reqInterval.on('complete', function(){
    c3area.parseRequest(this).render();
    c3line.parseRequest(this).render();
    c3bar.parseRequest(this).render();
    c3areaspline.parseRequest(this).render();
    c3spline.parseRequest(this).render();
    c3areastep.parseRequest(this).render();
    c3step.parseRequest(this).render();
  });




  var c3area_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('area')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-area-multi'))
    .prepare();

  var c3line_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('line')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-line-multi'))
    .prepare();

  var c3bar_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('bar')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-bar-multi'))
    .prepare();

  var c3areaspline_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('area-spline')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-area-spline-multi'))
    .prepare();

  var c3spline_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('spline')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-spline-multi'))
    .prepare();

  var c3step_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('step')
    .height(300)
    .stacked(true)
    .labelMapping(labelMap)
    .el(document.getElementById('c3-step-multi'))
    .prepare();

  var c3areastep_m = new Keen.Dataviz()
    // .library('c3')
    .chartType('area-step')
    .height(300)
    .stacked(true)
    // .labelMapping(labelMap)
    .el(document.getElementById('c3-area-step-multi'))
    .prepare();

  reqMultiline.on('complete', function(){
    c3area_m.parseRequest(this).render();
    c3line_m.parseRequest(this).render();
    c3bar_m.parseRequest(this).render();
    c3areaspline_m.parseRequest(this).render();
    c3spline_m.parseRequest(this).render();
    c3step_m.parseRequest(this).render();
    c3areastep_m.parseRequest(this).render();
  });

  var c3FunnelCats = [
    'Created Account',
    'Completed Profile',
    'Created Project',
    'Invited Teammate'
  ];

  window.c3funnel = new Keen.Dataviz()
    .el(document.getElementById('c3-funnel'))
    .library('c3')
    .chartType('bar')
    .colors([ Keen.Dataviz.defaults.colors[5] ])
    .labels(c3FunnelCats)
    .height(300)
    .chartOptions({
      // Overriding `axis` below wipes out auto-categorization
      // axis: {
      //     x: {
      //         type: 'category',
      //         categories: c3FunnelCats
      //     },
      //     y: {
      //         label: 'Unique users'
      //     }
      // },
      legend: {
        show: false
      }
    })
    .parseRawData({
      // Sample response for the funnel resource
      result: [ 9873, 6768, 2215, 909 ],
      steps: [
          { event_collection: 'create_account' },
          { event_collection: 'complete_profile' },
          { event_collection: 'create_project' },
          { event_collection: 'invite_teammate' }
      ]
    })
    .render();




    // RENDERING SAVED QUERIES

    // client.savedQueries().create('weekly-clicks-by-campaign', {
    //   refresh_rate: 0,
    //   query: {
    //     analysis_type: 'count',
    //     event_collection: 'clicks',
    //     timeframe: 'this_12_months',
    //     interval: 'weekly',
    //     group_by: 'ad.campaign_id' //['ad.campaign_id', 'user.id']
    //   }
    // });

    // var saved_query_chart = new Keen.Dataviz();

    client.draw('total-clicks-this-12-months', document.getElementById('sq-metric'), {
      height: 200,
      chartOptions: {
        gauge: {
          min: 0,
          max: 200
        }
      }
    });
    client.draw('total-clicks-by-campaign-this-12-months', document.getElementById('sq-grouped-metric'), {
      height: 200
    });

    client.draw('weekly-clicks-this-12-months', document.getElementById('sq-interval'), {
      height: 200
    });

    client.draw('weekly-clicks-by-campaign', document.getElementById('sq-grouped-interval'), {
      height: 200
    });

    client.draw('total-clicks-by-campaign-by-user-id', document.getElementById('sq-double-grouped-metric'), {
      height: 400,
      chartType: 'bar',
      chartOptions: {
        legend: { show: false }
      }
    });

    client.draw('weekly-clicks-by-campaign-by-user-id', document.getElementById('sq-double-grouped-interval'), {
      height: 400,
      chartOptions: {
        legend: { show: false }
      }
    });

    client.draw('export-last-10', document.getElementById('sq-extraction'), {
      height: 200
    });
    client.draw('list-campaign-ids', document.getElementById('sq-list'), {
      height: 200
    });

    // client.run('test-extraction-no-collection');

  </script>
</body>
<html>
